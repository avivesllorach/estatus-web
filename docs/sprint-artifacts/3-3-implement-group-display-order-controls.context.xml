<?xml version="1.0" encoding="UTF-8"?>
<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>3</epicId>
    <storyId>3</storyId>
    <title>Implement Group Display Order Controls</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-11-24T10:17:00.000Z</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/3-3-implement-group-display-order-controls.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>As a system administrator</asA>
    <iWant>I want to set the display order for dashboard groups</iWant>
    <soThat>so that I can control how groups appear on the monitoring dashboard according to my organizational preferences.</soThat>
    <tasks>Tasks/Subtasks:
- [ ] Add display order field to group edit form (AC: 1)
  - [ ] Add number input with proper validation attributes
  - [ ] Configure input with min="1" and default value handling
  - [ ] Position field appropriately in form layout
- [ ] Implement order validation logic (AC: 2)
  - [ ] Add validation for positive integers only
  - [ ] Display inline error messages for invalid values
  - [ ] Disable save button when validation fails
- [ ] Add up/down arrow controls (AC: 3)
  - [ ] Implement increment/decrement buttons with icons
  - [ ] Add keyboard support for arrow keys when field is focused
  - [ ] Ensure proper focus management and accessibility
- [ ] Add helper text and labels (AC: 4)
  - [ ] Add descriptive helper text below the field
  - [ ] Ensure proper ARIA labeling for screen readers
  - [ ] Maintain consistent styling with other form fields
- [ ] Implement real-time visual feedback (AC: 5)
  - [ ] Add onChange handlers to update form state immediately
  - [ ] Provide visual indicators when order changes
  - [ ] Ensure smooth user experience with immediate feedback
- [ ] Integrate with save functionality (AC: 6)
  - [ ] Ensure display order is included in save requests to backend
  - [ ] Test that order values persist correctly to dashboard-layout.json
  - [ ] Verify order changes trigger appropriate SSE events
- [ ] Handle duplicate order scenarios (AC: 7)
  - [ ] Allow duplicate order values without errors
  - [ ] Ensure backend sorting handles ties gracefully
  - [ ] Test behavior with multiple groups having same order
- [ ] Write comprehensive tests
  - [ ] Unit tests for validation logic
  - [ ] Integration tests for save functionality
  - [ ] UI tests for up/down arrow controls</tasks>
  </story>

  <acceptanceCriteria>1. **Display Order Field**: Group edit form includes a number input field for display order that accepts positive integers starting from 1
2. **Order Validation**: Display order must be a positive integer (minimum value of 1) with clear error messages for invalid values
3. **Visual Order Controls**: Up/down arrow buttons are provided next to the order field for easier adjustment with increment/decrement functionality
4. **Helper Text**: Field includes helper text explaining "Groups are displayed on the dashboard in ascending order"
5. **Real-time Preview**: Order changes show immediate visual feedback in the form interface
6. **Order Persistence**: Display order values are saved to the `dashboard-layout.json` file along with other group properties
7. **Duplicate Order Handling**: System allows duplicate order values and handles sorting appropriately (backend sorts by order, then by name for ties)</acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/architecture.md</path>
        <title>System Architecture</title>
        <section>Component Architecture</section>
        <snippet>Frontend Component Hierarchy includes GroupForm component (Epic 3) for add/edit group operations with FormSection and FormGroup components for consistent form patterns.</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-3.md</path>
        <title>Epic 3 Technical Specification</title>
        <section>Data Models and Contracts</section>
        <snippet>GroupConfig interface includes order field (1, 2, 3... for display order). Groups are displayed on dashboard in ascending order. Backend handles duplicate order values gracefully by sorting ties by name.</snippet>
      </doc>
      <doc>
        <path>docs/ux-design-specification.md</path>
        <title>UX Design Specification</title>
        <section>Design System Foundation</section>
        <snippet>shadcn/ui provides Button component with primary/secondary/destructive variants and Input component for form fields. Both support proper focus management, ARIA labeling, and accessibility features.</snippet>
      </doc>
      <doc>
        <path>docs/epics.md</path>
        <title>Epic Breakdown</title>
        <section>Epic 3: Story 3.3</section>
        <snippet>Story 3.3 implements group display order controls allowing users to change group display order using up/down arrow buttons or direct number input. Groups are displayed on dashboard in ascending order.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>src/components/groups/GroupForm.tsx</path>
        <kind>component</kind>
        <symbol>GroupForm</symbol>
        <lines>1-50</lines>
        <reason>Existing group form component that needs to be extended with display order field. Already imports Input, Button, FormSection, FormGroup components that will be reused.</reason>
      </artifact>
      <artifact>
        <path>src/components/ui/input.tsx</path>
        <kind>component</kind>
        <symbol>Input</symbol>
        <lines>5-19</lines>
        <reason>shadcn/ui Input component for number input field with proper styling, focus management, and accessibility features. Supports min validation and all required attributes.</reason>
      </artifact>
      <artifact>
        <path>src/components/ui/button.tsx</path>
        <kind>component</kind>
        <symbol>Button</symbol>
        <lines>1</lines>
        <reason>shadcn/ui Button component for up/down arrow controls with icon support and proper accessibility. Will be used for increment/decrement functionality.</reason>
      </artifact>
      <artifact>
        <path>src/types/group.ts</path>
        <kind>type</kind>
        <symbol>GroupConfig</symbol>
        <lines>2-7</lines>
        <reason>TypeScript interface defining GroupConfig with order field (number) for display order. This interface must be extended to include order in form state and API requests.</reason>
      </artifact>
    </code>
    <dependencies>
      <ecosystem name="frontend">
        <package name="@radix-ui/react-slot" version="^1.2.4" />
        <package name="class-variance-authority" version="^0.7.1" />
        <package name="clsx" version="^2.1.1" />
        <package name="tailwind-merge" version="^3.4.0" />
        <package name="lucide-react" version="^0.554.0" />
        <package name="react" version="^18.2.0" />
        <package name="react-dom" version="^18.2.0" />
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Maintain existing FormSection and FormGroup pattern for consistent layout with other form fields in GroupForm</constraint>
    <constraint>Use shadcn/ui Input component with number type and min="1" attribute for positive integer validation</constraint>
    <constraint>Implement real-time validation with inline error messages consistent with Epic 2 form patterns</constraint>
    <constraint>Ensure display order field is included in form state management and save operations</constraint>
    <constraint>Maintain accessibility standards with proper ARIA labels and keyboard navigation support</constraint>
    <constraint>Follow established naming conventions (camelCase for variables, PascalCase for components)</constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>GroupConfig.order</name>
      <kind>TypeScript interface field</kind>
      <signature>order: number;          // 1, 2, 3... (display order)</signature>
      <path>src/types/group.ts:5</path>
    </interface>
    <interface>
      <name>PUT /api/config/groups/:id</name>
      <kind>REST endpoint</kind>
      <signature>PUT /api/config/groups/:id - Request: { id: string, name: string, order: number, serverIds: string[] }</signature>
      <path>docs/sprint-artifacts/tech-spec-epic-3.md:135</path>
    </interface>
    <interface>
      <name>Input component props</name>
      <kind>React component interface</kind>
      <signature>Input extends React.ComponentProps&lt;"input"&gt; - supports type="number", min="1", required attributes</signature>
      <path>src/components/ui/input.tsx:5</path>
    </interface>
  </interfaces>

  <tests>
    <standards>Testing follows established patterns from existing GroupForm.test.tsx using @testing-library/react with render, screen, fireEvent utilities. Tests should mock API calls and validate form state changes, validation logic, and user interactions. Unit tests cover validation functions, integration tests cover save workflows, and accessibility tests verify keyboard navigation and ARIA compliance.</standards>
    <locations>src/components/groups/__tests__/GroupForm.test.tsx - Add new test cases for display order functionality following existing test structure and mock patterns.</locations>
    <ideas>
      <test idea="validate positive integer input - Test AC1 & AC2">Test that Input accepts positive integers (1, 2, 3) and rejects negative numbers, zero, and non-numeric input with appropriate error messages.</test>
      <test idea="up/down arrow controls - Test AC3">Test that up/down buttons increment/decrement the order value correctly and handle boundary conditions (minimum value of 1).</test>
      <test idea="helper text display - Test AC4">Verify that helper text "Groups are displayed on the dashboard in ascending order" appears below the input field.</test>
      <test idea="real-time feedback - Test AC5">Test that order changes immediately update form state and provide visual feedback without requiring save operation.</test>
      <test idea="save functionality - Test AC6">Test that display order is included in save requests to backend API and persists to dashboard-layout.json.</test>
      <test idea="duplicate order handling - Test AC7">Verify that multiple groups can have the same order value without errors and that backend handles sorting appropriately.</test>
      <test idea="keyboard accessibility">Test arrow key navigation when field is focused and proper focus management between up/down controls.</test>
    </ideas>
  </tests>
</story-context>