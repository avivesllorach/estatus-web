<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>3</storyId>
    <title>Display Server List in Sidebar</title>
    <status>drafted</status>
    <generatedAt>2025-11-18</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/1-3-display-server-list-in-sidebar.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>user</asA>
    <iWant>to see all my configured servers listed in the sidebar</iWant>
    <soThat>I can quickly scan my infrastructure and select servers to view/edit</soThat>
    <tasks>
      <task id="1" ac="1">
        <description>Fetch server data from backend API</description>
        <subtasks>
          <subtask>Create or update API service to fetch servers from GET /api/servers</subtask>
          <subtask>Add TypeScript interface for server data structure</subtask>
          <subtask>Handle loading and error states</subtask>
          <subtask>Verify data fetching works correctly</subtask>
        </subtasks>
      </task>
      <task id="2" ac="2,4,5">
        <description>Create ServerListItem component</description>
        <subtasks>
          <subtask>Create src/components/config/ServerListItem.tsx component</subtask>
          <subtask>Display server name (14px, font-semibold, text-gray-900)</subtask>
          <subtask>Display IP address below name (12px, font-mono, text-gray-600)</subtask>
          <subtask>Apply padding (12px / p-3 in Tailwind)</subtask>
          <subtask>Implement hover state (light gray background #f5f5f5 / hover:bg-gray-100)</subtask>
          <subtask>Add 8px gap between items (gap-2 in parent container)</subtask>
        </subtasks>
      </task>
      <task id="3" ac="1,3">
        <description>Integrate server list into Sidebar component</description>
        <subtasks>
          <subtask>Modify src/components/config/Sidebar.tsx to fetch and display servers</subtask>
          <subtask>Wrap server list in shadcn/ui ScrollArea component</subtask>
          <subtask>Map over servers array to render ServerListItem components</subtask>
          <subtask>Handle empty state (no servers configured)</subtask>
          <subtask>Verify server list renders correctly under "SERVERS" section label</subtask>
        </subtasks>
      </task>
      <task id="4" ac="all">
        <description>Test and verify rendering</description>
        <subtasks>
          <subtask>Verify server list loads on page mount</subtask>
          <subtask>Verify scrolling works if server list exceeds sidebar height</subtask>
          <subtask>Verify hover states work correctly</subtask>
          <subtask>Verify spacing and typography match UX spec</subtask>
          <subtask>Test with various numbers of servers (0, 1, 5, 20+)</subtask>
        </subtasks>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1">
      <given>I am on the /config page</given>
      <when>the page loads</when>
      <then>I see a list of all servers from backend/servers.json in the sidebar under "SERVERS" section</then>
    </criterion>
    <criterion id="2">
      <description>Each server list item displays server name (14px, semibold, gray-900) and IP address below name (12px, monospace, gray-600)</description>
    </criterion>
    <criterion id="3">
      <description>The server list is scrollable if it exceeds sidebar height (using shadcn/ui ScrollArea)</description>
    </criterion>
    <criterion id="4">
      <description>Hovering a server shows light gray background (#f5f5f5)</description>
    </criterion>
    <criterion id="5">
      <description>List items have 12px padding with 8px gap between items</description>
    </criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/architecture.md</path>
        <title>Estatus Web - Configuration UI Architecture</title>
        <section>Component Architecture - Frontend Component Hierarchy</section>
        <snippet>Shows ConfigLayout contains Sidebar which contains ServerListItem[] components. This story creates the ServerListItem component and integrates it into the existing Sidebar.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Estatus Web - Configuration UI Architecture</title>
        <section>API Design - Existing Endpoints</section>
        <snippet>GET /api/servers returns list of all servers with status. Returns ServerData[] with id, name, ip, dns, and monitoring configuration. This existing endpoint provides the data source for the server list.</snippet>
      </doc>
      <doc>
        <path>docs/ux-design-specification.md</path>
        <title>UX Design Specification</title>
        <section>6.1 - ServerListItem Component</section>
        <snippet>Server name: 14px, semibold, gray-900. IP address: 12px, monospace, gray-600. Hover: Light gray background (#f5f5f5). Padding: 12px (p-3 in Tailwind). Gap: 8px between items.</snippet>
      </doc>
      <doc>
        <path>docs/epics.md</path>
        <title>Epic Breakdown</title>
        <section>Story 1.3 - Display Server List in Sidebar</section>
        <snippet>Fetch servers via existing GET /api/servers endpoint. Build ServerListItem component with hover state. Use shadcn/ui ScrollArea for overflow. Map over servers array to render list items.</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/1-2-create-config-route-with-split-view-layout.md</path>
        <title>Story 1.2 - Create /config Route with Split-View Layout</title>
        <section>Completion Notes</section>
        <snippet>Sidebar component created at src/components/config/Sidebar.tsx with "SERVERS" and "GROUPS" section labels already in place. ConfigLayout structure established with 280px fixed sidebar. Path aliases configured (@/components). shadcn/ui components available including ScrollArea.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>src/components/config/Sidebar.tsx</path>
        <kind>component</kind>
        <symbol>Sidebar</symbol>
        <lines>1-19</lines>
        <reason>This is the component that needs to be modified to display the server list. Currently contains only section labels "SERVERS" and "GROUPS". Need to add server list rendering, ScrollArea integration, and state management.</reason>
      </artifact>
      <artifact>
        <path>src/services/api.ts</path>
        <kind>service</kind>
        <symbol>ApiService.fetchServers</symbol>
        <lines>62-81</lines>
        <reason>Existing method that fetches servers from GET /api/servers endpoint. Returns Promise&lt;ServerData[]&gt;. Can be reused directly in ConfigPage or Sidebar to fetch server data. Already handles error cases and updates internal servers map.</reason>
      </artifact>
      <artifact>
        <path>src/services/api.ts</path>
        <kind>interface</kind>
        <symbol>ServerData</symbol>
        <lines>13-23</lines>
        <reason>TypeScript interface for server objects returned from API. Contains all required fields: id, name, ip, isOnline, disk info, etc. Use this interface for type safety when rendering server list items.</reason>
      </artifact>
      <artifact>
        <path>src/components/ui/scroll-area.tsx</path>
        <kind>component</kind>
        <symbol>ScrollArea</symbol>
        <lines>6-22</lines>
        <reason>shadcn/ui ScrollArea component for customizing scrollbar appearance. Use to wrap server list for smooth scrolling when list exceeds sidebar height. Already installed and ready to use.</reason>
      </artifact>
      <artifact>
        <path>src/pages/ConfigPage.tsx</path>
        <kind>component</kind>
        <symbol>ConfigPage</symbol>
        <reason>Route component for /config page. This is where data fetching logic should be added (useEffect to fetch servers on mount). Pass server data to Sidebar component as props.</reason>
      </artifact>
    </code>
    <dependencies>
      <node>
        <react>^18.2.0</react>
        <react-dom>^18.2.0</react-dom>
        <react-router-dom>^7.9.6</react-router-dom>
        <lucide-react>^0.554.0</lucide-react>
        <radix-ui-react-scroll-area>^1.2.10</radix-ui-react-scroll-area>
        <typescript>^5.2.2</typescript>
        <tailwindcss>^3.4.3</tailwindcss>
        <vite>^4.5.3</vite>
      </node>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Use existing ApiService.fetchServers() method - do not create new API fetch logic</constraint>
    <constraint>Fetch server data in ConfigPage component using useEffect on mount - not in Sidebar component</constraint>
    <constraint>Pass server data from ConfigPage to Sidebar as props - maintain unidirectional data flow</constraint>
    <constraint>Use ServerData interface from src/services/api.ts for type safety</constraint>
    <constraint>Follow existing component pattern: functional components with TypeScript interfaces</constraint>
    <constraint>Use Tailwind utility classes only - no custom CSS files</constraint>
    <constraint>Apply exact UX spec values: 14px name, 12px IP, p-3 padding, gap-2 spacing, hover:bg-gray-100</constraint>
    <constraint>Use @/components path alias for imports (already configured)</constraint>
    <constraint>ScrollArea height calculation: h-[calc(100vh-200px)] to reserve space for sections</constraint>
    <constraint>Handle three states: loading ("Loading servers..."), empty ("No servers configured yet"), populated (render list)</constraint>
    <constraint>Do not modify existing Dashboard component or API backend - brownfield safety</constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>GET /api/servers</name>
      <kind>REST endpoint</kind>
      <signature>GET /api/servers â†’ ApiResponse&lt;ServerData[]&gt;</signature>
      <path>backend/src/routes/servers.ts</path>
      <description>Existing endpoint that returns list of all configured servers with monitoring status. Use ApiService.fetchServers() wrapper method.</description>
    </interface>
    <interface>
      <name>ApiService.fetchServers</name>
      <kind>async method</kind>
      <signature>async fetchServers(): Promise&lt;ServerData[]&gt;</signature>
      <path>src/services/api.ts</path>
      <description>Wrapper method for GET /api/servers endpoint. Handles error cases, updates internal Map, returns typed ServerData array. Reuse this method.</description>
    </interface>
    <interface>
      <name>ServerListItemProps</name>
      <kind>component props interface</kind>
      <signature>interface ServerListItemProps { server: { id: string; name: string; ip: string }; onClick?: () =&gt; void }</signature>
      <description>Props interface for new ServerListItem component. Takes minimal server data (id, name, ip) and optional onClick handler for future selection feature (Story 1.4).</description>
    </interface>
    <interface>
      <name>SidebarProps (new)</name>
      <kind>component props interface</kind>
      <signature>interface SidebarProps { servers: ServerData[]; isLoading: boolean }</signature>
      <description>New props interface for Sidebar component. Receives server data and loading state from parent ConfigPage. Sidebar becomes presentational component.</description>
    </interface>
  </interfaces>

  <tests>
    <standards>
      No formal testing framework configured yet (Epic 1 is UI foundation only). Manual verification required using browser DevTools. Future stories will add automated tests with testing frameworks.
    </standards>
    <locations>
      No test directories exist yet. Tests will be added in Epic 2 when backend endpoints are created.
    </locations>
    <ideas>
      <idea ac="1">Manual test: Navigate to http://localhost:5173/config, verify server list appears below "SERVERS" label. Count list items, should match backend/servers.json count.</idea>
      <idea ac="2">Manual test: Inspect list item in DevTools, verify name is 14px font-semibold text-gray-900, IP is 12px font-mono text-gray-600.</idea>
      <idea ac="3">Manual test: Add 20+ servers to backend/servers.json, verify ScrollArea appears and scrolling works smoothly.</idea>
      <idea ac="4">Manual test: Hover over list items, verify background changes to #f5f5f5 (gray-100 in Tailwind).</idea>
      <idea ac="5">Manual test: Measure spacing in DevTools, verify 12px padding (p-3) on items and 8px gap (gap-2) between items.</idea>
      <idea ac="all">Edge case test: Empty backend/servers.json, verify "No servers configured yet" message appears instead of empty list.</idea>
      <idea ac="all">Edge case test: Simulate network error (block API in DevTools), verify error state handled gracefully.</idea>
    </ideas>
  </tests>
</story-context>
