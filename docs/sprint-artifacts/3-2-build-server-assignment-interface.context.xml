<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>3</epicId>
    <storyId>2</storyId>
    <title>Build Server Assignment Interface</title>
    <status>drafted</status>
    <generatedAt>2025-11-24</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>/home/arnau/estatus-web/docs/sprint-artifacts/3-2-build-server-assignment-interface.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>system administrator</asA>
    <iWant>enhance the server assignment interface within the group form with advanced filtering and bulk operations</iWant>
    <soThat>I can efficiently manage large numbers of servers across multiple groups with improved user experience</soThat>
    <tasks>- [ ] Enhance server assignment interface with advanced filtering (AC: 1, 2)
  - [ ] Add server status indicators (online/offline) with color coding
  - [ ] Display last check timestamp for each server
  - [ ] Implement search/filter functionality by server name and IP
  - [ ] Add status-based filtering (online/offline only)
- [ ] Implement bulk selection operations (AC: 3)
  - [ ] Add "Select All" and "Deselect All" buttons
  - [ ] Add keyboard shortcuts for bulk operations
  - [ ] Ensure bulk operations respect current filter state
- [ ] Improve visual organization and grouping (AC: 4)
  - [ ] Group servers by status with clear section headers
  - [ ] Add collapsible sections for online/offline server groups
  - [ ] Implement responsive grid layout for server items
- [ ] Add enhanced feedback and indicators (AC: 5, 6)
  - [ ] Show real-time server count updates
  - [ ] Add visual feedback when servers are selected/deselected
  - [ ] Implement hover states and selection highlights
- [ ] Ensure responsive design and accessibility (AC: 7)
  - [ ] Test interface on different screen sizes
  - [ ] Ensure keyboard navigation works properly
  - [ ] Add appropriate ARIA labels for screen readers
- [ ] Write comprehensive tests
  - [ ] Unit tests for filtering and selection logic
  - [ ] Integration tests for form submission
  - [ ] Accessibility tests for keyboard navigation</tasks>
  </story>

  <acceptanceCriteria>1. Enhanced Server Display: Server assignment interface shows additional server metadata (status, last check time) beyond basic name and IP
2. Search and Filter: Users can search/filter servers by name, IP address, or online/offline status
3. Bulk Selection: Users can select/deselect multiple servers at once using "Select All" and "Deselect All" buttons
4. Server Grouping: Available servers are visually grouped by status (online/offline) for better organization
5. Server Count Indicator: Shows real-time count of assigned servers versus total available servers
6. Validation Feedback: Clear visual feedback when servers are added/removed from groups
7. Responsive Design: Server assignment interface works well on different screen sizes</acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/prd.md" title="Product Requirements Document" section="FR31-FR35 - Group Management" snippet="FR31: User can assign servers to a group via group edit form. FR32: User can remove servers from a group. FR33: User can move servers between groups. FR34: User can reorder groups using up/down controls. FR35: System displays which servers are assigned to each group."/>
      <doc path="docs/sprint-artifacts/tech-spec-epic-3.md" title="Epic 3 Technical Specification" section="Server Assignment Interface Design" snippet="Users can assign servers to groups via a multi-select interface showing server name and IP address. Servers can belong to multiple groups simultaneously. Group creation and updates should feel instantaneous to users maintaining the efficient UX established in Epic 1."/>
      <doc path="docs/ux-design-specification.md" title="UX Design Specification" section="Split-View Layout and Form Patterns" snippet="Primary Pattern: Split-view / List-Detail (Master-Detail) - Left sidebar: Browsable list of servers and groups, Right panel: Detailed edit form for selected item. Users can quickly scan server list while maintaining editing context."/>
      <doc path="docs/epics.md" title="Epic Definitions" section="Story 3.2 - Build Server Assignment Interface" snippet="Given I am editing a group, When I view the 'Assigned Servers' section of the form, Then I see a list or multi-select showing all available servers. And servers already assigned to this group are pre-selected. And I can check/uncheck servers to add/remove them from the group."/>
    </docs>
    <code>
      <artifact path="src/components/groups/GroupForm.tsx" kind="component" symbol="GroupForm" lines="330-383" reason="Existing server assignment UI that needs enhancement - currently shows basic checkbox list with server name, IP, and online/offline status. Contains handleServerToggle() logic for adding/removing servers from selection."/>
      <artifact path="src/components/config/forms/shared/FormSection.tsx" kind="component" symbol="FormSection" reason="Reusable card-based layout component with bg-white rounded-lg shadow-sm styling used for consistent form sections."/>
      <artifact path="src/components/config/forms/shared/FormGroup.tsx" kind="component" symbol="FormGroup" reason="Standardized form field wrapper with validation support and helper text display for form organization."/>
      <artifact path="src/components/config/PanelHeader.tsx" kind="component" symbol="PanelHeader" reason="Reusable panel header with save/cancel/delete buttons, dirty state management, and error handling patterns."/>
      <artifact path="src/components/ui/checkbox.tsx" kind="component" symbol="Checkbox" reason="Radix UI based checkbox component used for server selection in the assignment interface."/>
      <artifact path="src/components/ui/label.tsx" kind="component" symbol="Label" reason="Radix UI based label component paired with checkboxes for accessibility."/>
      <artifact path="src/components/ui/input.tsx" kind="component" symbol="Input" reason="Text input component that can be used for search/filter functionality."/>
      <artifact path="src/types/server.ts" kind="type" symbol="ServerData" reason="Type definition defining server structure with id, name, ip, isOnline, lastCheckTime fields needed for enhanced display."/>
      <artifact path="src/types/server.ts" kind="type" symbol="GroupConfig" reason="Type definition with serverIds: string[] array for tracking assigned servers in groups."/>
    </code>
    <dependencies>
  <ecosystem name="react" version="18.2.0">
    <package name="@radix-ui/react-checkbox" version="1.3.3" purpose="Accessible checkbox component for server selection"/>
    <package name="@radix-ui/react-label" version="2.1.8" purpose="Accessible label component paired with checkboxes"/>
    <package name="@radix-ui/react-scroll-area" version="1.2.10" purpose="Scrollable container for server lists"/>
    <package name="@radix-ui/react-collapsible" version="1.1.12" purpose="Collapsible sections for server groups"/>
  </ecosystem>
  <ecosystem name="utility">
    <package name="lucide-react" version="0.554.0" purpose="Icons for search, filter, and bulk operation buttons"/>
    <package name="clsx" version="2.1.1" purpose="Conditional class names for styling"/>
    <package name="tailwind-merge" version="3.4.0" purpose="Tailwind CSS class merging"/>
  </ecosystem>
  <ecosystem name="styling">
    <package name="tailwindcss" version="3.4.3" purpose="Utility-first CSS framework"/>
    <package name="tailwindcss-animate" version="1.0.7" purpose="Animation utilities for UI transitions"/>
  </ecosystem>
</dependencies>
  </artifacts>

  <constraints>
- Extend existing GroupForm.tsx component rather than creating new files
- Maintain established UI patterns from Epic 2 forms (FormSection, FormGroup, PanelHeader)
- Ensure consistency with existing Checkbox and Label components
- Follow established pattern for form state management and validation
- Use existing serverData interface and GroupConfig.serverIds array structure
- Preserve current handleServerToggle() logic for server selection/deselection
- Maintain responsive design principles from existing config UI
- Follow accessibility standards established in existing components (ARIA labels, keyboard navigation)
- Use existing color scheme and styling patterns (blue for primary actions, green for online status)
- Ensure bulk selection operations respect current filter state
- Add search/filter functionality above existing server list without breaking current layout
</constraints>
  <interfaces>
<interface name="ServerData" kind="TypeScript interface" signature="interface ServerData { id: string; name: string; ip: string; isOnline: boolean; lastCheckTime?: string; }" path="src/types/server.ts"/>
<interface name="GroupConfig" kind="TypeScript interface" signature="interface GroupConfig { id: string; name: string; order: number; serverIds: string[]; }" path="src/types/server.ts"/>
<interface name="handleServerToggle" kind="Function signature" signature="(serverId: string, checked: boolean) => void" path="src/components/groups/GroupForm.tsx"/>
<interface name="Checkbox" kind="React component" signature="Checkbox: React.ForwardRefExoticComponent&lt;CheckboxProps & React.RefAttributes&lt;HTMLInputElement&gt;&gt;" path="src/components/ui/checkbox.tsx"/>
<interface name="Label" kind="React component" signature="Label: React.ForwardRefExoticComponent&lt;LabelProps & React.RefAttributes&lt;HTMLLabelElement&gt;&gt;" path="src/components/ui/label.tsx"/>
<interface name="Input" kind="React component" signature="Input: React.ForwardRefExoticComponent&lt;InputProps & React.RefAttributes&lt;HTMLInputElement&gt;&gt;" path="src/components/ui/input.tsx"/>
  </interfaces>
  <tests>
    <standards>Tests use React Testing Library with Jest framework. Test files follow __tests__ directory pattern next to component files. Mock data includes realistic server objects with id, name, ip, isOnline, and timestamps. Test patterns include render, fireEvent, screen queries, and mock functions for callbacks.</standards>
    <locations>src/components/groups/__tests__/GroupForm.test.tsx - existing test suite for GroupForm component that should be extended with new feature tests.</locations>
    <ideas>
      <test idea="Unit test for search functionality - Verify search input filters servers correctly by name and IP address" acceptanceCriteria="2"/>
      <test idea="Unit test for status filtering - Verify online/offline status filter shows appropriate servers" acceptanceCriteria="2"/>
      <test idea="Unit test for bulk selection - Verify Select All button selects all filtered servers and respects current filter state" acceptanceCriteria="3"/>
      <test idea="Unit test for server grouping - Verify servers are visually grouped by status with section headers" acceptanceCriteria="4"/>
      <test idea="Unit test for server count indicator - Verify real-time count updates when servers are selected/deselected" acceptanceCriteria="5"/>
      <test idea="Integration test for form submission - Verify enhanced server assignment submits correct serverIds array" acceptanceCriteria="1,6"/>
      <test idea="Accessibility test for keyboard navigation - Verify tab order, ARIA labels, and screen reader announcements" acceptanceCriteria="7"/>
      <test idea="Performance test for large server lists - Verify filtering and selection remain responsive with 50+ servers" acceptanceCriteria="2,7"/>
    </ideas>
  </tests>
</story-context>