<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1.5</storyId>
    <title>Display Group List in Sidebar</title>
    <status>drafted</status>
    <generatedAt>2025-11-19</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/1-5-display-group-list-in-sidebar.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>user</asA>
    <iWant>to see all dashboard groups listed in the sidebar</iWant>
    <soThat>I can view and select groups for editing</soThat>
    <tasks>
      <task id="1" ac="1">
        <description>Create backend endpoint GET /api/config/groups</description>
        <subtasks>
          <subtask>Create new route file backend/src/routes/config.ts</subtask>
          <subtask>Implement GET handler to read dashboard-layout.json</subtask>
          <subtask>Return { success: true, data: groups[] } if file exists</subtask>
          <subtask>Return { success: true, data: [] } if file doesn't exist</subtask>
          <subtask>Handle file read errors gracefully (return 500 with error message)</subtask>
          <subtask>Test endpoint manually via browser or curl</subtask>
        </subtasks>
      </task>
      <task id="2" ac="2,3">
        <description>Create GroupListItem component</description>
        <subtasks>
          <subtask>Create file src/components/config/GroupListItem.tsx</subtask>
          <subtask>Define GroupListItemProps interface: { group, isActive, onClick }</subtask>
          <subtask>Implement GroupConfig type: { id, name, order, serverIds[] }</subtask>
          <subtask>Render group name (14px, semibold, gray-900)</subtask>
          <subtask>Calculate and render server count: {group.serverIds.length} servers</subtask>
          <subtask>Apply conditional styling: active (bg-blue-50), hover (bg-gray-100)</subtask>
          <subtask>Add keyboard support (Enter/Space to select) - reuse pattern from ServerListItem</subtask>
          <subtask>Add ARIA attributes: aria-current, aria-label, role="listitem"</subtask>
          <subtask>Use forwardRef pattern for keyboard navigation support</subtask>
        </subtasks>
      </task>
      <task id="3" ac="1">
        <description>Fetch groups in ConfigPage</description>
        <subtasks>
          <subtask>Add groups state variable: const [groups, setGroups] = useState&lt;GroupConfig[]&gt;([])</subtask>
          <subtask>Add fetch call in useEffect: GET /api/config/groups</subtask>
          <subtask>Fetch groups in parallel with servers (existing useEffect)</subtask>
          <subtask>Handle loading state (shared with servers)</subtask>
          <subtask>Handle error state (display error message if fetch fails)</subtask>
          <subtask>Update Sidebar props to pass groups array</subtask>
        </subtasks>
      </task>
      <task id="4" ac="1,4">
        <description>Render group list in Sidebar</description>
        <subtasks>
          <subtask>Add "GROUPS" section label (uppercase, 12px, gray-600, mt-6)</subtask>
          <subtask>Map over groups array to render GroupListItem components</subtask>
          <subtask>Pass isActive prop: selectedGroupId === group.id</subtask>
          <subtask>Pass onClick prop: calls onSelectGroup(group.id)</subtask>
          <subtask>Wrap group list in ScrollArea if needed</subtask>
          <subtask>Add empty state: "No groups created yet." if groups.length === 0</subtask>
          <subtask>Implement keyboard navigation for group list (arrow keys, focus management)</subtask>
          <subtask>Add role="list" and aria-label="Group list" to container</subtask>
        </subtasks>
      </task>
      <task id="5" ac="All">
        <description>Wire up group selection handler</description>
        <subtasks>
          <subtask>Verify handleSelectGroup function exists in ConfigPage (created in Story 1.4)</subtask>
          <subtask>Pass onSelectGroup handler to Sidebar component</subtask>
          <subtask>Test clicking a group updates selectedGroupId state</subtask>
          <subtask>Test clicking a group clears selectedServerId state (mutual exclusivity)</subtask>
          <subtask>Verify active state applies correctly (blue background)</subtask>
        </subtasks>
      </task>
      <task id="6" ac="All">
        <description>Test and verify group list behavior</description>
        <subtasks>
          <subtask>Test with existing groups: verify all groups display with correct server count</subtask>
          <subtask>Test with zero groups: verify empty state message displays</subtask>
          <subtask>Test group selection: click group → verify blue background, aria-current="true"</subtask>
          <subtask>Test mutual exclusivity: select server → select group → verify server deselected</subtask>
          <subtask>Test keyboard navigation: Tab to groups, Arrow keys navigate, Enter selects</subtask>
          <subtask>Test visual design: verify colors match UX spec (gray-900, gray-600, blue-50, blue-600)</subtask>
          <subtask>Build project (npm run build) → verify no TypeScript errors</subtask>
        </subtasks>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1">
      <given>I am on the `/config` page</given>
      <when>the page loads</when>
      <then>I see a list of all groups under "GROUPS" section in sidebar</then>
    </criterion>
    <criterion id="2">
      <description>Each group list item displays: Group name (14px, semibold, gray-900) and Server count below name (12px, gray-600, e.g., "4 servers")</description>
    </criterion>
    <criterion id="3">
      <description>The group list supports the same interaction patterns as server list: Hover state (light gray background), Scrollable if overflow, 12px padding, 8px gap</description>
    </criterion>
    <criterion id="4">
      <description>Groups are visually separated from servers by the section label</description>
    </criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/epics.md</path>
        <title>Epic Breakdown</title>
        <section>Story 1.5: Display Group List in Sidebar</section>
        <snippet>User can view all groups under "GROUPS" section in sidebar. Each group list item displays group name and server count. The group list supports the same interaction patterns as server list (hover, scrollable, spacing).</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-1.md</path>
        <title>Epic 1 Technical Specification</title>
        <section>APIs and Interfaces - GET /api/config/groups</section>
        <snippet>New endpoint reads dashboard-layout.json file (if exists) and returns groups array. Returns empty array [] if file doesn't exist. Simple implementation for Epic 1: reads file, parses JSON, returns { success: true, data: groups }.</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-1.md</path>
        <title>Epic 1 Technical Specification</title>
        <section>Data Models and Contracts - GroupConfig</section>
        <snippet>GroupConfig interface: { id: string, name: string, order: number, serverIds: string[] }. Matches dashboard-layout.json schema. serverIds array references servers from servers.json (foreign key pattern).</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture Document</title>
        <section>Decision 6: API Endpoint Design</section>
        <snippet>New endpoint follows RESTful pattern: GET /api/config/groups. Nested under /api/config namespace (same as future server CRUD endpoints). Returns ApiResponse&lt;GroupConfig[]&gt; wrapper. Read-only for Epic 1 (CRUD operations in Epic 3).</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture Document</title>
        <section>Decision 7: Group-to-Server Relationship Model</section>
        <snippet>Array of Server IDs (Foreign Key Pattern). dashboard-layout.json groups reference servers via serverIds array. No data duplication. Servers can belong to multiple groups. Standard relational pattern.</snippet>
      </doc>
      <doc>
        <path>docs/ux-design-specification.md</path>
        <title>UX Design Specification</title>
        <section>7.1 Navigation Patterns - Active State</section>
        <snippet>Group list items use SAME visual design as server list items. Active state: bg-blue-50 (#eff6ff), text-blue-600 (#2563eb). Hover state: hover:bg-gray-100 (#f5f5f5). Server count in gray-600 (#6b7280), 12px font size.</snippet>
      </doc>
      <doc>
        <path>docs/ux-design-specification.md</path>
        <title>UX Design Specification</title>
        <section>8.2 Keyboard Navigation</section>
        <snippet>Tab order: Servers section first, then Groups section. Arrow keys navigate within each section independently. Enter key selects highlighted group. Groups section needs separate keyboard navigation state (focusedGroupIndex, groupRefs array).</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/1-4-implement-server-selection-with-active-state.md</path>
        <title>Story 1.4 Completion</title>
        <section>Learnings from Previous Story</section>
        <snippet>ServerListItem pattern established using forwardRef, conditional styling with cn(), keyboard support (Enter/Space), ARIA attributes. Keyboard navigation pattern: focusedIndex state + refs array + handleKeyDown with ArrowUp/ArrowDown. State management in ConfigPage: selectedGroupId and handleSelectGroup already created - just need to wire up.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>src/components/config/ServerListItem.tsx</path>
        <kind>component</kind>
        <symbol>ServerListItem</symbol>
        <lines>1-57</lines>
        <reason>PATTERN TO REUSE: GroupListItem should follow exact same structure - forwardRef, conditional styling with cn(), keyboard support (handleKeyDown), ARIA attributes (aria-current, aria-label, role="listitem"), tabIndex={0}, active/hover states</reason>
      </artifact>
      <artifact>
        <path>src/components/config/Sidebar.tsx</path>
        <kind>component</kind>
        <symbol>Sidebar</symbol>
        <lines>entire file</lines>
        <reason>MODIFY: Add GROUPS section after servers. Add focusedGroupIndex state, groupRefs array, handleGroupKeyDown function for group keyboard navigation. Import and render GroupListItem components.</reason>
      </artifact>
      <artifact>
        <path>src/pages/ConfigPage.tsx</path>
        <kind>component</kind>
        <symbol>ConfigPage</symbol>
        <lines>entire file</lines>
        <reason>MODIFY: Add groups state variable, fetch GET /api/config/groups in parallel with servers (Promise.all), pass groups to Sidebar props. handleSelectGroup already exists from Story 1.4 - verify it's wired up to Sidebar.</reason>
      </artifact>
      <artifact>
        <path>backend/src/server.ts</path>
        <kind>server</kind>
        <symbol>ServerMonitoringApp</symbol>
        <lines>1-50</lines>
        <reason>MODIFY: Import and register new config routes: import configRoutes from './routes/config'; app.use('/api/config', configRoutes); Pattern follows existing route registration for servers and events.</reason>
      </artifact>
      <artifact>
        <path>backend/src/routes/servers.ts</path>
        <kind>route</kind>
        <symbol>createServerRoutes</symbol>
        <lines>entire file</lines>
        <reason>REFERENCE: Use as pattern for creating backend/src/routes/config.ts. Similar structure: Router, async handlers, try-catch error handling, JSON response with success/data or success/error format.</reason>
      </artifact>
      <artifact>
        <path>src/lib/utils.ts</path>
        <kind>utility</kind>
        <symbol>cn</symbol>
        <lines>entire file</lines>
        <reason>REUSE: cn() function for conditional class merging in GroupListItem. Pattern: cn(baseClasses, isActive ? activeClasses : hoverClasses). Same usage as ServerListItem.</reason>
      </artifact>
    </code>
    <dependencies>
      <frontend>
        <package name="react" version="^18.2.0" />
        <package name="react-dom" version="^18.2.0" />
        <package name="react-router-dom" version="^7.9.6" />
        <package name="typescript" version="^5.2.2" />
        <package name="tailwindcss" version="^3.4.3" />
        <package name="@radix-ui/react-scroll-area" version="^1.2.10" />
        <package name="lucide-react" version="^0.554.0" note="For Plus icon in Add Group button" />
        <package name="class-variance-authority" version="^0.7.1" />
        <package name="clsx" version="^2.1.1" />
        <package name="tailwind-merge" version="^3.4.0" />
      </frontend>
      <backend>
        <package name="express" version="^4.18.2" />
        <package name="@types/express" version="^4.17.21" />
        <package name="typescript" version="^5.3.3" />
        <package name="tsx" version="^4.20.3" note="For dev server" />
      </backend>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>
      <category>Architecture</category>
      <rule>Follow Architectural Decision #6: New endpoint GET /api/config/groups follows RESTful pattern, nested under /api/config namespace</rule>
    </constraint>
    <constraint>
      <category>Architecture</category>
      <rule>Follow Architectural Decision #7: Groups use serverIds array (foreign key pattern) to reference servers. No data duplication.</rule>
    </constraint>
    <constraint>
      <category>Component Pattern</category>
      <rule>GroupListItem MUST use exact same pattern as ServerListItem: forwardRef, conditional styling, keyboard support, ARIA attributes</rule>
    </constraint>
    <constraint>
      <category>State Management</category>
      <rule>Mutual exclusivity: Selecting a group clears server selection and vice versa (handleSelectGroup and handleSelectServer in ConfigPage)</rule>
    </constraint>
    <constraint>
      <category>Visual Design</category>
      <rule>Follow UX Design 7.1: Active state bg-blue-50, text-blue-600. Hover state hover:bg-gray-100. Font sizes: 14px (name), 12px (count). Colors: gray-900 (name), gray-600 (count)</rule>
    </constraint>
    <constraint>
      <category>Keyboard Navigation</category>
      <rule>Follow UX Design 8.2: Arrow keys navigate within group list. Enter selects. Tab order: Servers first, then Groups. Separate keyboard state for groups (focusedGroupIndex, groupRefs array)</rule>
    </constraint>
    <constraint>
      <category>Accessibility</category>
      <rule>WCAG 2.1 AA compliance: aria-current="true" for active group, aria-label for screen readers, role="listitem" and role="list", keyboard navigation support</rule>
    </constraint>
    <constraint>
      <category>File System</category>
      <rule>Backend endpoint must handle missing dashboard-layout.json gracefully: return empty array [] if file doesn't exist (normal for fresh install)</rule>
    </constraint>
    <constraint>
      <category>Error Handling</category>
      <rule>Backend: Try-catch all file I/O, return 500 with error message on failure. Frontend: Handle API errors, display user-friendly message</rule>
    </constraint>
    <constraint>
      <category>Data Integrity</category>
      <rule>serverIds in GroupConfig must reference valid server IDs. Server count calculated as group.serverIds.length. Handle singular/plural: "1 server" vs "X servers"</rule>
    </constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>GET /api/config/groups</name>
      <kind>REST endpoint</kind>
      <signature>GET /api/config/groups → ApiResponse&lt;GroupConfig[]&gt;</signature>
      <path>backend/src/routes/config.ts (NEW FILE)</path>
      <details>
        <request>No parameters</request>
        <response_success>{ success: true, data: [{ id, name, order, serverIds }] }</response_success>
        <response_empty>{ success: true, data: [] } (if dashboard-layout.json doesn't exist)</response_empty>
        <response_error>{ success: false, error: "Failed to load groups" } (status 500)</response_error>
      </details>
    </interface>
    <interface>
      <name>GroupConfig</name>
      <kind>TypeScript interface</kind>
      <signature>interface GroupConfig { id: string; name: string; order: number; serverIds: string[] }</signature>
      <path>src/types/group.ts (NEW FILE)</path>
      <details>
        <field name="id">Unique group identifier (e.g., "group-1")</field>
        <field name="name">Display name (e.g., "ARAGÓ")</field>
        <field name="order">Display order number (1, 2, 3...)</field>
        <field name="serverIds">Array of server IDs belonging to this group</field>
      </details>
    </interface>
    <interface>
      <name>GroupListItem</name>
      <kind>React component</kind>
      <signature>forwardRef&lt;HTMLDivElement, { group: GroupConfig; isActive: boolean; onClick: () =&gt; void }&gt;</signature>
      <path>src/components/config/GroupListItem.tsx (NEW FILE)</path>
      <details>
        <prop name="group">GroupConfig object with id, name, order, serverIds</prop>
        <prop name="isActive">Boolean indicating if this group is currently selected</prop>
        <prop name="onClick">Handler function called when group is clicked or selected via keyboard</prop>
        <prop name="ref">Forwarded ref for keyboard navigation focus management</prop>
      </details>
    </interface>
    <interface>
      <name>Sidebar (extended)</name>
      <kind>React component props</kind>
      <signature>SidebarProps { servers, groups, selectedServerId, selectedGroupId, onSelectServer, onSelectGroup, ... }</signature>
      <path>src/components/config/Sidebar.tsx (MODIFY)</path>
      <details>
        <prop name="groups" status="NEW">GroupConfig[] array to render in GROUPS section</prop>
        <prop name="selectedGroupId" status="EXISTING">Currently selected group ID (from ConfigPage state)</prop>
        <prop name="onSelectGroup" status="EXISTING">Handler to call when group is selected</prop>
      </details>
    </interface>
    <interface>
      <name>ConfigPage (extended)</name>
      <kind>React component state</kind>
      <signature>ConfigPage state: { servers, groups, selectedServerId, selectedGroupId, isLoading, error }</signature>
      <path>src/pages/ConfigPage.tsx (MODIFY)</path>
      <details>
        <state name="groups" status="NEW">const [groups, setGroups] = useState&lt;GroupConfig[]&gt;([])</state>
        <state name="selectedGroupId" status="EXISTING">Created in Story 1.4, now will be populated by group selection</state>
        <handler name="handleSelectGroup" status="EXISTING">Created in Story 1.4, sets selectedGroupId and clears selectedServerId</handler>
      </details>
    </interface>
    <interface>
      <name>dashboard-layout.json schema</name>
      <kind>JSON file format</kind>
      <signature>{ "groups": [{ id, name, order, serverIds }] }</signature>
      <path>backend/dashboard-layout.json (may not exist yet)</path>
      <details>
        <field name="groups">Array of GroupConfig objects</field>
        <note>File may not exist on fresh install - backend returns empty array [] if missing</note>
      </details>
    </interface>
  </interfaces>

  <tests>
    <standards>
      Epic 1 uses manual testing approach (no automated tests for MVP). Testing standards: TypeScript compilation (npm run build) must succeed with zero errors. Visual verification against UX Design spec for colors, spacing, fonts. Keyboard navigation tested manually (Tab, Arrow keys, Enter). Accessibility attributes verified via browser DevTools (aria-current, aria-label, role attributes). Screen reader testing recommended but not blocking (NVDA on Windows or VoiceOver on macOS).
    </standards>
    <locations>
      <location>No automated test files for Epic 1 (manual testing only)</location>
      <location>Build verification: npm run build (frontend and backend) must succeed</location>
      <location>Manual testing checklist in story Dev Notes section</location>
    </locations>
    <ideas>
      <idea ac="1">Backend endpoint test: curl http://localhost:3000/api/config/groups → verify { success: true, data: [] } response if no dashboard-layout.json exists</idea>
      <idea ac="1">Backend endpoint test: Create backend/dashboard-layout.json with sample groups → re-test endpoint → verify groups returned</idea>
      <idea ac="1">Frontend fetch test: Navigate to /config → verify GET /api/config/groups call in Network tab → verify groups state populated</idea>
      <idea ac="2">GroupListItem render test: Verify group name (14px, semibold, gray-900) and server count (12px, gray-600) display correctly</idea>
      <idea ac="2">Server count singular/plural test: Group with 1 server shows "1 server", group with 3 servers shows "3 servers"</idea>
      <idea ac="3">Visual design test: Hover over non-active group → verify gray background (#f5f5f5). Active group → verify blue background (#eff6ff)</idea>
      <idea ac="3">Scrollability test: Create 20+ groups → verify sidebar scrolls, ScrollArea works correctly</idea>
      <idea ac="4">Section separation test: Verify "GROUPS" label (uppercase, 12px, gray-600) appears with mt-6 spacing from servers section</idea>
      <idea ac="all">Group selection test: Click group → verify blue background, selectedGroupId updated, aria-current="true" attribute present</idea>
      <idea ac="all">Mutual exclusivity test: Select server → select group → verify server deselects (white background), group selects (blue)</idea>
      <idea ac="all">Keyboard navigation test: Tab to groups section → Arrow Down → verify focus moves to next group → Enter → verify group selects</idea>
      <idea ac="all">Empty state test: Zero groups → verify "No groups created yet." message displays</idea>
      <idea ac="all">Build verification test: npm run build (both frontend and backend) → verify no TypeScript errors</idea>
    </ideas>
  </tests>
</story-context>
